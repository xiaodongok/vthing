{"version":3,"file":"index.js","sources":["../shared/input.ts","../core/input-number/index.ts","../shared/index.ts","../core/input-float/index.ts"],"sourcesContent":["import type {VNode} from \"@vue/runtime-core\";\r\n\r\ntype InputElement = HTMLInputElement | HTMLTextAreaElement\r\n\r\nexport interface IVnode extends VNode {\r\n  inputLocking: boolean\r\n}\r\n\r\nexport const getInputElement = (el: HTMLElement, vnode: VNode): InputElement | null => {\r\n  const input = (vnode.type === 'input' ? el : el.children.item(0)) as InputElement;\r\n  if (input === null || input.tagName !== \"INPUT\") {\r\n    console.error(\"请在输入框中绑定\")\r\n    return null\r\n  }\r\n  return input\r\n}\r\n","import type {ObjectDirective} from \"@vue/runtime-core\"\r\nimport type {IVnode} from \"../../shared/input\"\r\nimport {getInputElement} from \"../../shared/input\";\r\n\r\nexport const inputNumber: ObjectDirective<HTMLInputElement | HTMLTextAreaElement> = {\r\n  created(el, binding, vnode) {\r\n    const iVnode = (vnode as IVnode)\r\n    let input = getInputElement(el,vnode)\r\n    if (!input) {\r\n      return;\r\n    }\r\n    input.addEventListener('compositionstart', () => {\r\n      iVnode.inputLocking = true\r\n    })\r\n    input.addEventListener('compositionend', () => {\r\n      iVnode.inputLocking = false\r\n      input?.dispatchEvent(new Event('input'))\r\n    })\r\n    input.addEventListener(\"input\", () => {\r\n      if (iVnode.inputLocking || !input) {\r\n        return;\r\n      }\r\n      let oldValue = input.value;\r\n      let newValue = input.value;\r\n\r\n      newValue = newValue.replace(/[^0-9]/g, '')\r\n      if(newValue!==oldValue){\r\n        input.value = newValue;\r\n        input.dispatchEvent(new Event(\"input\"))\r\n      }\r\n    })\r\n  }\r\n}\r\n","export const isNumber = (value:object) => typeof value === \"number\"\r\n\r\nexport const isUndefined = (value:object) => typeof value === \"undefined\"\r\n","import type {ObjectDirective} from \"@vue/runtime-core\"\r\nimport type {IVnode} from \"../../shared/input\"\r\nimport {getInputElement} from \"../../shared/input\";\r\nimport {isNumber, isUndefined} from \"../../shared\";\r\n\r\nexport const inputFloat: ObjectDirective<HTMLInputElement | HTMLTextAreaElement> = {\r\n  created(el, binding, vnode) {\r\n    if (!isUndefined(binding.value) && !isNumber(binding.value)) {\r\n      console.error(\"参数输入错误，请输入number类型\")\r\n      return;\r\n    }\r\n\r\n    const iVnode = (vnode as IVnode)\r\n    let input = getInputElement(el, vnode)\r\n    if (!input) {\r\n      return;\r\n    }\r\n    input.addEventListener('compositionstart', () => {\r\n      iVnode.inputLocking = true\r\n    })\r\n    input.addEventListener('compositionend', () => {\r\n      iVnode.inputLocking = false\r\n      input?.dispatchEvent(new Event('input'))\r\n    })\r\n    input.addEventListener(\"input\", () => {\r\n      if (iVnode.inputLocking || !input) {\r\n        return;\r\n      }\r\n      let oldValue = input.value;\r\n      let newValue = input.value;\r\n\r\n      // 清除\"数字\"和\".\"以外的字符\r\n      newValue = newValue.replace(/[^\\d.]/g, '')\r\n      // 只保留第一个点, 清除多余的\r\n      newValue = newValue.replace(/(\\..*)\\./g, \"$1\")\r\n      // 不能以 0 开头\r\n      newValue = newValue.replace(/^0([0-9])/g, '$1')\r\n      // 第一个字符如果是.号，则补充前缀0\r\n      newValue = newValue.replace(/^\\./g, '0.')\r\n      // 去除多余小数位\r\n      if (isNumber(binding.value)) {\r\n        newValue = newValue.replace(new RegExp(`(\\\\.\\\\d{0,${binding.value}}).*$`), '$1')\r\n      }\r\n\r\n      if (newValue !== oldValue) {\r\n        input.value = newValue;\r\n        input.dispatchEvent(new Event(\"input\"))\r\n      }\r\n    })\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}